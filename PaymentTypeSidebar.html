<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 13px;
        padding: 12px;
      }
      h2 {
        font-size: 14px;
        margin: 0 0 8px;
      }
      .list {
        border: 1px solid #ddd;
        max-height: 360px;
        overflow-y: auto;
        padding: 6px;
        margin-bottom: 8px;
      }
      .item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 4px;
      }
      .item label {
        cursor: pointer;
      }
      .code {
        font-family: monospace;
        padding: 1px 4px;
        border-radius: 3px;
        border: 1px solid #ccc;
        margin-right: 4px;
        font-size: 11px;
      }
      .desc {
        color: #555;
        font-size: 11px;
      }
      button {
        margin-top: 6px;
        padding: 4px 10px;
        font-size: 12px;
      }
      .footer {
        margin-top: 6px;
        font-size: 11px;
        color: #777;
      }
    </style>
  </head>
  <body>
    <h2>支払い区分の設定</h2>
    <div style="margin-bottom:4px;">
      会社ID: <b><?= companyId ?></b><br>
      コースID: <b><?= courseId ?></b>
    </div>

    <div class="list">
      <? for (var i = 0; i < paymentTypes.length; i++) {
           var pt = paymentTypes[i];
           var checked = selectedPaymentTypes.indexOf(pt.value) !== -1;
      ?>
        <div class="item">
          <label>
            <input type="checkbox"
                   class="pt-checkbox"
                   value="<?= pt.value ?>"
                   <?= checked ? 'checked' : '' ?>>
            <span class="code"><?= pt.value ?></span>
            <? if (pt.desc) { ?>
              <span class="desc"><?= pt.desc ?></span>
            <? } ?>
          </label>
        </div>
      <? } ?>
    </div>

    <button onclick="onSave()">保存</button>

    <div class="footer">
      ※ 複数選択した場合は「;」区切りで保存されます。<br>
      ※ 候補の追加・説明文の変更は code_master（item="payment_type"）で行います。
    </div>

    <script>
      function onSave() {
        var checkboxes = document.querySelectorAll('.pt-checkbox');
        var selected = [];
        checkboxes.forEach(function(cb) {
          if (cb.checked) selected.push(cb.value);
        });

        google.script.run
          .withSuccessHandler(function() {
            google.script.host.close();
          })
          .savePaymentTypes(<?= rowIndex ?>, selected);
      }
    </script>
  </body>
</html>

